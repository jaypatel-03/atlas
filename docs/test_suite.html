<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>test_suite.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>test_suite.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">test_interface</span><span class="w"> </span><span class="kn">import</span> <span class="n">TestInterface</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">module_test_data</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModuleTestData</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_tkagg</span><span class="w"> </span><span class="kn">import</span> <span class="n">FigureCanvasTkAgg</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">tk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tkinter</span><span class="w"> </span><span class="kn">import</span> <span class="n">messagebox</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span><span class="w"> </span><span class="nc">PrelimTests</span><span class="p">(</span><span class="n">TestInterface</span><span class="p">):</span>
    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Preliminary Tests&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">controller</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">controller</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;View&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sanitise_plot_eye_diagram</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">))</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">get_test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_data</span> <span class="p">:</span> <span class="n">ModuleTestData</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mod_data</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;post&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;eyeDiagram&#39;</span><span class="p">,</span> <span class="s1">&#39;IV-MEASURE&#39;</span><span class="p">,</span> <span class="s1">&#39;corecolumnscan&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">mod_data</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;final_cold&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;eyeDiagram&#39;</span><span class="p">,</span> <span class="s1">&#39;IV-MEASURE&#39;</span><span class="p">,</span> <span class="s1">&#39;ADC-CALIBRATION&#39;</span><span class="p">,</span> <span class="s1">&#39;ANALOG-READBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;SLDO&#39;</span><span class="p">,</span> <span class="s1">&#39;VCAL-CALIBRATION&#39;</span><span class="p">,</span> <span class="s1">&#39;INJECTION-CAPACITANCE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATA-TRANSMISSION&#39;</span><span class="p">,</span> <span class="s1">&#39;corecolumnscan&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;eyeDiagram&#39;</span><span class="p">,</span> <span class="s1">&#39;IV-MEASURE&#39;</span><span class="p">,</span> <span class="s1">&#39;ADC-CALIBRATION&#39;</span><span class="p">,</span> <span class="s1">&#39;ANALOG-READBACK&#39;</span><span class="p">,</span> <span class="s1">&#39;SLDO&#39;</span><span class="p">,</span> <span class="s1">&#39;VCAL-CALIBRATION&#39;</span><span class="p">,</span> <span class="s1">&#39;INJECTION-CAPACITANCE&#39;</span><span class="p">,</span> <span class="s1">&#39;LP-MODE&#39;</span><span class="p">,</span> <span class="s1">&#39;DATA-TRANSMISSION&#39;</span><span class="p">,</span> <span class="s1">&#39;corecolumnscan&#39;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>Reads and sanitises the shell output of the eyeDiagram script. Removes new line breaks, removes pipe delimiter, and removes shell colour information.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">sanitise_plot_eye_diagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">mod_data</span> <span class="p">:</span> <span class="n">ModuleTestData</span><span class="p">,</span> <span class="n">file</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;./logs/eyeDiagram.log&quot;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>Args:
    master: controlling tk.Frame to pass through to other functions 
    mod_data
    file (str): path to eyeDiagram.log. Default is ./logs/eyeDiagram.log</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Plotting eyeDiagram&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="p">[]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>ANSI escape sequence (\x1b[) + Select Graphic Rendition subset for colours (32 = green, 0 = black). Adds colour to eyeDiagram output</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">green</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\x1b[32m&#39;</span>
        <span class="n">black</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\x1b[0m&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Reading line&quot;</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;0 | &quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;unicode_escape&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span> <span class="c1"># remove weird encoding and convert to bash string</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">black</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                    <span class="n">parts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)]</span>
                    <span class="n">row</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="s2">&quot;Determining&quot;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">):</span>
                    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">delay</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;green&quot;</span> <span class="k">if</span> <span class="s2">&quot;width&quot;</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">else</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open_eyediagram_popup</span><span class="p">(</span><span class="n">master</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">: Run eye diagram first&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Plots the heatmap for the eyeDiagram, as well as whether suitable delays have been found or not and gives the option (as checkboxes) to disable or re-enable particular chips.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">open_eyediagram_popup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">eye_diag</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">delay</span> <span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="n">mod_data</span> <span class="p">:</span> <span class="n">ModuleTestData</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p>Args: 
    master: Controlling tk.Frame so that a popup can be added on top.
    eye_diag (list[int]): sanitised link quality values from eye diagram shell output (output of sanitise_plot_eye_diagram function)
    delay (list[bool]): list of booleans indicating whether a delay has been successfully found for a certain lane (output of sanitise_plot_eye_diagram function)</p>
<p>TODO: incorporate into plot_eye_diagram?</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">top</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Toplevel</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">transient</span><span class="p">(</span><span class="n">master</span><span class="p">)</span>
        <span class="n">top</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;eyeDiagram&quot;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>plots the heatmap for the eyeDiagram </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">plot1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="n">plot1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">eye_diag</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;winter&#39;</span><span class="p">)</span>
        <span class="n">plot1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Channel&quot;</span><span class="p">)</span>
        <span class="n">plot1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Lane&quot;</span><span class="p">)</span>
        
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasTkAgg</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">master</span> <span class="o">=</span> <span class="n">top</span><span class="p">)</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">get_tk_widget</span><span class="p">()</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p>uses the output from the processed config JSON to create labels stating whether a suitable delay has been found for each lane. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">enabled</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chip_enabled</span><span class="p">(</span><span class="n">mod_data</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">delay</span><span class="p">:</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. &quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;Delay found&quot;</span> <span class="k">if</span> <span class="n">d</span> <span class="o">==</span> <span class="s2">&quot;green&quot;</span> <span class="k">else</span> <span class="s2">&quot;Delay not found&quot;</span><span class="p">),</span> <span class="n">fg</span><span class="o">=</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>creates a column of checkboxes to allow for disabling/enabling particular ASICS. </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox_flags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">enabled</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox_flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">IntVar</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">a</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chk</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Checkbutton</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Chip </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox_flags</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">onvalue</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">offvalue</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">chk</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chk</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">chk</span><span class="o">.</span><span class="n">select</span><span class="p">()</span> <span class="c1">#turn on checkboxes corresponding to on chips. </span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">checkbox_flags</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ok_btn</span> <span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;OK&quot;</span><span class="p">,</span><span class="n">command</span> <span class="o">=</span> <span class="k">lambda</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_chips</span><span class="p">(</span><span class="n">top</span><span class="p">,</span><span class="n">mod_data</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkbox_flags</span><span class="p">]))</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">row</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">columnspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p>Reads the relevant config file, located in module-qc-database-tools, to output which ASICs are turned on.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">chip_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_data</span> <span class="p">:</span> <span class="n">ModuleTestData</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      <p>Args:
    mod_data: ModuleTestData object containing ID and serial number 
Returns:
    enabled: list of integers in [0,1] designating whether the corresponding ASIC is off or on.  </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">loc_id</span><span class="p">,</span> <span class="n">mod_sn</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mod_data_loaded</span><span class="p">(</span><span class="n">mod_data</span><span class="p">)</span>
        <span class="n">enabled</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">home_path</span> <span class="o">=</span> <span class="n">mod_data</span><span class="o">.</span><span class="n">home_path</span>
        <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">home_path</span><span class="si">}</span><span class="s2">/module-qc-database-tools/</span><span class="si">{</span><span class="n">loc_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mod_sn</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mod_sn</span><span class="si">}</span><span class="s2">_L2_</span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">.json&quot;</span>
    
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Read successful&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Chip </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> enabled: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;chips&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;enable&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
            <span class="n">enabled</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;chips&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;enable&#39;</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">enabled</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      <p>Writes to the config JSON with updated information (from checkboxes) as to which ASICS are to be turned off or on. If there is any write error, the original data is written in stead.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">disable_chips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">mod_data</span> <span class="p">:</span> <span class="n">ModuleTestData</span><span class="p">,</span> <span class="n">chk_boxes</span> <span class="p">:</span> <span class="nb">list</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Args:
    master: controlling tk.Frame so that the popup can be closed
    mod_data: ModuleTestData object containing local ID and serial number, as well as whether it is a warm or cold test so that the correct JSON file can be located.
    chk_boxes (list[int]): list of integers corresponding to whether chip[i] is off (0) or on (1). </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">loc_id</span><span class="p">,</span> <span class="n">mod_sn</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mod_data_loaded</span><span class="p">(</span><span class="n">mod_data</span><span class="p">)</span>
        <span class="n">home_path</span> <span class="o">=</span> <span class="n">mod_data</span><span class="o">.</span><span class="n">home_path</span>
        <span class="n">file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">home_path</span><span class="si">}</span><span class="s2">/module-qc-database-tools/</span><span class="si">{</span><span class="n">loc_id</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mod_sn</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">mod_sn</span><span class="si">}</span><span class="s2">_L2_</span><span class="si">{</span><span class="n">temp</span><span class="si">}</span><span class="s2">.json&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonfile</span><span class="p">)</span>
        <span class="n">data_edited</span> <span class="o">=</span> <span class="n">data</span> <span class="c1"># to preserve original data in case of RW error    </span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">data_edited</span><span class="p">[</span><span class="s1">&#39;chips&#39;</span><span class="p">][</span><span class="n">a</span><span class="p">][</span><span class="s1">&#39;enable&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chk_boxes</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data_edited</span><span class="p">,</span> <span class="n">jsonfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;JSON RW error : unable to save new config&quot;</span><span class="p">)</span>
                <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s2">&quot;showerror&quot;</span><span class="p">,</span> <span class="s2">&quot;JSON RW error : unable to save new config&quot;</span><span class="p">)</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">jsonfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Config edited&quot;</span><span class="p">)</span>   
        <span class="n">master</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span><span class="w"> </span><span class="nc">MinHealthTests</span><span class="p">(</span><span class="n">TestInterface</span><span class="p">):</span>
    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Mininum Health Tests&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">get_test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;std_digitalscan&quot;</span><span class="p">,</span> <span class="s2">&quot;std_analogscan&quot;</span><span class="p">,</span> <span class="s2">&quot;std_thresholdscan_hr&quot;</span><span class="p">,</span> <span class="s2">&quot;std_totscan -t 6000&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span><span class="w"> </span><span class="nc">Tuning</span><span class="p">(</span><span class="n">TestInterface</span><span class="p">):</span>
    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Tuning&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">get_test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_mod_data_loaded</span><span class="p">(</span><span class="n">mod_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;std_tune_globalthreshold -t 1700&quot;</span><span class="p">,</span> <span class="s2">&quot;std_tune_globalpreamp -t 6000 7&quot;</span><span class="p">,</span> <span class="s2">&quot;std_tune_globalthreshold -t 1700&quot;</span><span class="p">,</span> <span class="s2">&quot;std_tune_pixelthreshold -t 1500&quot;</span><span class="p">,</span> <span class="s2">&quot;std_thresholdscan_hd&quot;</span><span class="p">,</span> <span class="s2">&quot;std_totscan -t 6000&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">version</span> <span class="o">==</span> <span class="s2">&quot;v2&quot;</span> <span class="k">else</span> <span class="p">[</span><span class="s2">&quot;std_tune_globalthreshold -t 1700&quot;</span><span class="p">,</span> <span class="s2">&quot;std_totscan -t 6000&quot;</span><span class="p">,</span> <span class="s2">&quot;std_tune_globalthreshold -t 1700&quot;</span><span class="p">,</span> <span class="s2">&quot;std_tune_pixelthreshold -t 1500&quot;</span><span class="p">,</span> <span class="s2">&quot;std_retune_globalthreshold -t 1700&quot;</span><span class="p">,</span> <span class="s2">&quot;std_retune_pixelthreshold -t 1500&quot;</span><span class="p">,</span> <span class="s2">&quot;std_thresholdscan_hd&quot;</span><span class="p">,</span> <span class="s2">&quot;std_totscan -t 6000&quot;</span><span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span><span class="w"> </span><span class="nc">PixelFailTests</span><span class="p">(</span><span class="n">TestInterface</span><span class="p">):</span>
    <span class="n">test_name</span> <span class="o">=</span> <span class="s2">&quot;Pixel Fail&quot;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span><span class="w"> </span><span class="nf">get_test_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mod_data</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mod_data</span><span class="o">.</span><span class="n">stage</span> <span class="o">==</span> <span class="s2">&quot;final_cold&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;std_discbumpscan&quot;</span><span class="p">,</span> <span class="s2">&quot;std_mergedbumpscan -t 1500&quot;</span><span class="p">,</span> <span class="s2">&quot;std_thresholdscan_zerobias&quot;</span><span class="p">,</span> <span class="s2">&quot;std_noisescan&quot;</span><span class="p">,</span> <span class="s2">&quot;selftrigger_source -p&quot;</span><span class="p">,</span> <span class="s2">&quot;selftrigger_source&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;std_discbumpscan&quot;</span><span class="p">,</span> <span class="s2">&quot;std_mergedbumpscan -t 1500&quot;</span><span class="p">,</span> <span class="s2">&quot;std_thresholdscan_zerobias&quot;</span><span class="p">,</span> <span class="s2">&quot;std_noisescan&quot;</span><span class="p">]</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
